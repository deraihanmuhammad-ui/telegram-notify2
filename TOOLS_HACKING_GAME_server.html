<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Top Up - Client (pakai server)</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>body{background:#f7fafc;font-family:Segoe UI, Tahoma, Geneva, Verdana,sans-serif}</style>
</head>
<body>
  <div class="container mx-auto p-6 max-w-xl">
    <h1 class="text-2xl font-bold mb-4">Notifikasi ke Telegram (via server)</h1>
    <p class="mb-4">Server harus berjalan di <code>http://localhost:3000</code> (atau ubah SERVER_URL di bawah).</p>

    <div class="mb-4">
      <label class="block mb-2">Email atau No. Telepon</label>
      <input id="email" class="w-full px-3 py-2 border rounded" placeholder="contoh: nama@email.com / 0812..." />
    </div>

    <div class="mb-4">
      <label class="block mb-2">Paket</label>
      <select id="package" class="w-full px-3 py-2 border rounded">
        <option value="70 Diamond|Rp 10.000">70 Diamond - Rp 10.000</option>
        <option value="140 Diamond|Rp 20.000">140 Diamond - Rp 20.000</option>
        <option value="355 Diamond|Rp 50.000">355 Diamond - Rp 50.000</option>
      </select>
    </div>

    <button id="sendBtn" class="bg-blue-600 text-white px-4 py-2 rounded">Kirim Notifikasi</button>

    <div id="status" class="mt-4 text-sm"></div>
  </div>

<script>
const SERVER_URL = "http://localhost:3000"; // ubah kalau server di host lain

document.getElementById('sendBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  if (!email) return alert('Isi email atau nomor telepon dulu');
  const pkg = document.getElementById('package').value.split('|');
  const payload = {
    email,
    packageName: pkg[0],
    price: pkg[1],
    userAgent: navigator.userAgent
  };
  document.getElementById('status').textContent = 'Mengirim...';
  try {
    const res = await fetch(SERVER_URL + '/send', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const j = await res.json();
    if (j.ok) {
      document.getElementById('status').textContent = 'Berhasil dikirim ke Telegram âœ…';
      document.getElementById('email').value = '';
    } else {
      document.getElementById('status').textContent = 'Gagal: ' + (j.error?.description || JSON.stringify(j.error) || 'unknown');
    }
  } catch (err) {
    console.error(err);
    document.getElementById('status').textContent = 'Error koneksi ke server: ' + err.message;
  }
});
</script>
</body>
</html>
